<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>pyscript tutorial</title>
	
	<link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
	<script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <py-env>
     - serial
     - time
     - pymysql
    </py-env>
</head>
<body>
	<py-script>  
miConexion = pymysql.connect(host='localhost', user="root", passwd="12345678" , db="registrador")
cur = miConexion.cursor()
        
        
# conexion con el puerto serial
        
arduino = serial.Serial('COM4',9600)
        
        
while True:
        
    time.sleep(2) #descansa cada 2 segundos la lectura
    data = arduino.readline() #toma la lectura del monitor serial en la linea
    dato = data.split() #crea una lista de data en dato binario
    #print(dato) #imprime en terminal la informacion capturada
        
    #convierte dato binario en scrip y luego a flotante para la base de datos
    # tomar en cuenta que solo se imprima desde arduino los valores de los datos
    temperatura = float(dato[1].decode("utf-8")) 
            
    #print(temperatura)
    humedad = float(dato[0].decode("utf-8"))
    #print(humedad)
        
    # insertando los valores del puerto serial a la base de datos
    # ---------para temperatura --------
    query = "INSERT historial (datos,fecha,id_sensor) VALUES (%s,now(),1)" % temperatura
    print(query)
    cur.execute(query)
    miConexion.commit()
    # ---------para humedad --------
    query = "INSERT historial (datos,fecha,id_sensor) VALUES (%s,now(),71)" % humedad
    print(query)
    cur.execute(query)
    miConexion.commit()
        
miConexion.close()
arduino.close()
    </py-script>
</body>
</html>